{
  "id" : "b00b1.131",
  "moduleIdx" : 301,
  "baseId" : "b00b1.117",
  "name" : "CoffeeScript Block Diagram",
  "url" : "?id=b00b1.131",
  "valid" : true,
  "editor" : "martin",
  "editorIp" : "58.28.155.63",
  "timestamp" : "2014-03-12 14:12:43",
  "isoTime" : "2014-03-12T14:12:43+13:00",
  "canAccessFolder" : true,
  "isSandbox" : false,
  "canCommit" : true,
  "share" : null,
  "isPublic" : true,
  "price" : null,
  "uses" : "b007c.5",
  "imports" : [
    {
      "id" : "b007c.5",
      "moduleIdx" : 221,
      "baseId" : "b007c.4",
      "name" : "Module Languages",
      "url" : "?id=b007c.5",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2013-08-22 20:20:34",
      "isoTime" : "2013-08-22T20:20:34+12:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : "gary",
      "isPublic" : true,
      "price" : null,
      "depth" : 1,
      "fromUses" : false,
      "importer" : "b00b1.131"
    },
    {
      "id" : "b000n.5",
      "moduleIdx" : 20,
      "baseId" : "b000n.4",
      "name" : "HTML\/JavaScript definition",
      "url" : "?id=b000n.5",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2012-08-19 12:17:24",
      "isoTime" : "2012-08-19T12:17:24+12:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : null,
      "isPublic" : true,
      "price" : null,
      "depth" : 2,
      "fromUses" : false,
      "importer" : "b007c.5"
    },
    {
      "id" : "b006m.2",
      "moduleIdx" : 199,
      "baseId" : "b006m.1",
      "name" : "CoffeeScript definition",
      "url" : "?id=b006m.2",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2012-12-10 13:59:29",
      "isoTime" : "2012-12-10T13:59:29+13:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : null,
      "isPublic" : true,
      "price" : null,
      "depth" : 2,
      "fromUses" : false,
      "importer" : "b007c.5"
    },
    {
      "id" : "b000d.15",
      "moduleIdx" : 12,
      "baseId" : "b000d.14",
      "name" : "Python definition",
      "url" : "?id=b000d.15",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2013-05-20 15:20:43",
      "isoTime" : "2013-05-20T15:20:43+12:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : "gary",
      "isPublic" : true,
      "price" : null,
      "depth" : 2,
      "fromUses" : false,
      "importer" : "b007c.5"
    },
    {
      "id" : "b000g.10",
      "moduleIdx" : 14,
      "baseId" : "b000g.9",
      "name" : "Octave definition",
      "url" : "?id=b000g.10",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2013-08-22 20:03:42",
      "isoTime" : "2013-08-22T20:03:42+12:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : "gary",
      "isPublic" : true,
      "price" : null,
      "depth" : 2,
      "fromUses" : false,
      "importer" : "b007c.5"
    }
  ],
  "defs" : {
    "html" : {
      "src" : "b000n.5",
      "fileExt" : "html",
      "endToken" : "<!--puzlet_end-->",
      "endTokenExec" : "<!--puzlet_end-->",
      "passThru" : "true"
    },
    "javascript" : {
      "src" : "b000n.5",
      "fileExt" : "js",
      "endToken" : "\/\/!end",
      "endTokenExec" : "\/\/!end",
      "includeInHtmlHead" : "true"
    },
    "css" : {
      "src" : "b000n.5",
      "fileExt" : "css",
      "endToken" : "\/*!end*\/",
      "endTokenExec" : "\/*!end*\/",
      "includeInHtmlHead" : "true"
    },
    "coffee" : {
      "src" : "b006m.2",
      "fileExt" : "coffee",
      "endToken" : "#!end",
      "endTokenExec" : "#!end",
      "includeInHtmlHead" : "true"
    },
    "python" : {
      "src" : "b000d.15",
      "fileExt" : "py",
      "preamble" : "#!puzlet",
      "preambleExec" : "import puzlet",
      "postambleExec" : "puzlet.endScript()",
      "endToken" : "#!end",
      "endTokenExec" : "puzlet.end",
      "preProcessFileCommand" : "\nexport PYTHONPATH=..\/..\/..\/puzlet\/b000d.15; python ..\/..\/..\/puzlet\/b000d.15\/preprocessscript.py\n",
      "execFileCommand" : "\nexport PYTHONPATH=..\/..\/..\/puzlet\/b000d.15; python -W ignore::DeprecationWarning\n"
    },
    "octave" : {
      "src" : "b000g.10",
      "fileExt" : "m",
      "endToken" : "%!end",
      "endTokenExec" : "_end",
      "preProcessFileCommand" : "\nexport PYTHONPATH=..\/..\/..\/puzlet\/b000g.10; python ..\/..\/..\/puzlet\/b000g.10\/preprocessoctave.py\n",
      "execFileCommand" : "\noctave -H --no-line-editing -q\n"
    }
  },
  "exports" : null,
  "htmlResources" : "<script src='\/puzlet\/php\/source.php?pageId=b00b1.131&file=resources.js' type='text\/javascript'><\/script>\n<script src='\/puzlet\/php\/source.php?pageId=b00b1.131&file=draw.js' type='text\/javascript'><\/script>\n",
  "usedModulePath" : [
    "..\/..\/..\/puzlet\/b007c.5",
    "..\/..\/..\/puzlet\/b000n.5",
    "..\/..\/..\/puzlet\/b006m.2",
    "..\/..\/..\/puzlet\/b000d.15",
    "..\/..\/..\/puzlet\/b000g.10"
  ],
  "codeNodes" : [
    {
      "id" : "5",
      "lang" : "coffee",
      "filename" : "resources.coffee",
      "fileNoExt" : "resources",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "#!end",
      "idxInFile" : 0,
      "idxInPage" : 0,
      "codeBlockLength" : 11,
      "codeBlockStart" : 0,
      "show" : "0",
      "out" : "1",
      "code" : "$pz.resources = -> [        \n        {moduleId: \"b0088\", file: \"drawing.js\"}\n    \t{file: \"draw.js\"}\n\t\t{url: \"\/puzlet\/custom\/custom.js\"}\n\t\t{url: \"http:\/\/jashkenas.github.io\/\"+\n            \"coffee-script\/extras\/coffee-script.js\"}\n        {url: \"\/jslib\/vkbeautify.0.99.00.beta.js\"}\n]"
    },
    {
      "id" : "6",
      "lang" : "html",
      "filename" : "draw.html",
      "fileNoExt" : "draw",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "<!--puzlet_end-->",
      "idxInFile" : 0,
      "idxInPage" : 1,
      "codeBlockLength" : 5,
      "codeBlockStart" : 0,
      "show" : "0",
      "out" : "1",
      "code" : "<div id=\"canvas\">\n<\/div>"
    },
    {
      "id" : "7",
      "lang" : "html",
      "filename" : "mathjax.html",
      "fileNoExt" : "mathjax",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "<!--puzlet_end-->",
      "idxInFile" : 0,
      "idxInPage" : 2,
      "codeBlockLength" : 4,
      "codeBlockStart" : 0,
      "show" : "0",
      "out" : "0",
      "code" : "<div id=\"mathjax\"><\/div>"
    },
    {
      "id" : "3",
      "lang" : "coffee",
      "filename" : "draw.coffee",
      "fileNoExt" : "draw",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "#!end",
      "idxInFile" : 0,
      "idxInPage" : 3,
      "codeBlockLength" : 91,
      "codeBlockStart" : 0,
      "show" : "1",
      "out" : "1",
      "code" : "window.drawing = ->\n    \n    # setup drawing\n    unit = 48 \n    d = new Drawing\n        id: \"canvas\"\n        height: 500\n        unit: unit\n        showJunctions: false\n        defaultFill: \"yellow\"\n    \n    # shortcuts\n    [block, junc, connect, inp, output] = d.shortcuts()\n        \n    # feedforward gain (anchor with absolute coordinates)\n    ffg = block {o: [120, 80], label: \"$k_r$\"}\n    inp {o: ffg.left, label: \"$r(s)$\"}\n    \n    # feedback error\n    fbe = block {o: ffg.right, type: \"sum\"}\n    \n    # common subsystem for process and model (B,A,C,1\/s)\n    class feedbackSystem\n        constructor: (@spec) ->\n            d.defaultFill = @spec.fill if @spec.fill?\n            @B = block {o: @spec.o, label: @label(\"B\")}  # input gain\n            @E = block {o: @B.right, type: \"sum\"}\n            @I = block {o: @E.right, \\\n                        label: \"$\\\\Large\\\\frac{1}{s}$\"}  # integrator\n            @I.j = junc {o: @I.right, label: \"I\"}\n            @I.j2 = junc {o: @I.j.bottom, label: \"I2\", offset: 3\/2*unit}\n            @A = block {o: @I.j2.left, label: @label(\"A\")}  # fb gain\n            connect @A.left, @E.bottom\n            @C = block {o: @I.j.right, label: @label(\"C\")}  # output gain\n            @C.j = junc {o: @C.right, label: \"C\"}\n        label: (name) -> @spec.labels?[name] ? \"$#{name}$\"\n    \n    # process\n    fbe.j = junc {o: fbe.right, label: \"fbe\"}\n    process = new feedbackSystem {o: fbe.j.right, fill: \"blue\"}\n    output {o: process.C.j.right, label: \"$y(s)$\"}    \n    process.I.right.label {label: \"$x$\"}\n    process.I.left.label {label: \"$\\\\dot{x}$\"}\n    \n    # process system equation\n    p = process.I.top\n    t = block \n        o: [p.x, p.y-30]\n        width: 300\n        label: \"$\\\\color{blue}{H(s)=C(sI-A)^{-1}B}$\"\n    t.style \"fill:white; fill-opacity: 0.5;\"\n    \n    # model\n    fbe.j2 = junc {o: fbe.j.bottom, label: \"fbe2\", offset: 5*unit}\n    model = new feedbackSystem \n        o: fbe.j2.right, labels: {C: \"$-C$\"}, fill: \"red\"\n    model.I.right.label {label: \"$\\\\hat{x}$\"}\n    model.I.left.label {label: \"$\\\\dot{\\\\hat{x}}$\"}\n    model.C.j.right.label {label:\"$-\\\\hat{y}$\"}\n\n    d.defaultFill = \"yellow\"\n    \n    # observer error\n    obe = block {o: process.C.j.bottom, offset: 3*unit, type: \"sum\"}\n    obe.style \"fill:red; fill-opacity:0.1; stroke:black; stroke-width:1.5\"\n    obe.left.label {label: \"$\\\\varepsilon$\"}\n    connect model.C.right, obe.bottom\n    \n    # observer gain\n    L = block {o: [process.E.x, obe.y], label: \"$L$\"}\n    L.style \"fill:red; fill-opacity:0.1; stroke:black; stroke-width:1.5\"\n    connect obe.left, L.right\n    connect L.bottom, model.E.top\n    \n    # observer system equation\n    p = model.E.bottom\n    t = block \n        o: [p.x, p.y+2.3*unit]\n        width: 300\n        label: \"$\\\\small\\\\color{red}{\\\\dot{\\\\hat{x}}=(A-BK-LC)\\\\hat{x}+Ly}$\"\n    t.style \"fill:white; fill-opacity: 0.5;\"\n    \n    # feedback gain\n    K = block {o: [fbe.x, L.y], label: \"$-K$\"}\n    K.style \"fill:yellow; fill-opacity:0.1; stroke:red; stroke-width:2\"\n    K.j = junc {o: model.I.j2.bottom, label: \"fbg\", offset: 1.5*unit}\n    connect K.j.left, K.bottom\n    connect K.top, fbe.bottom"
    }
  ]
}